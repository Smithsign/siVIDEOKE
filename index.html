<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Orange Dynasty Videoke</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <video autoplay loop muted id="bg-video">
    <source src="background.mp4" type="video/mp4" />
  </video>

  <div id="karaoke-wrapper">
    <h1>ğŸ§¡ Orange Dynasty Videoke ğŸ‰</h1>

    <div id="songbook">
      <input type="text" id="songcode" placeholder="Enter Song Number" readonly />
      <div id="numpad">
        <button>1</button><button>2</button><button>3</button>
        <button>4</button><button>5</button><button>6</button>
        <button>7</button><button>8</button><button>9</button>
        <button>0</button><button id="clear">C</button><button id="play">Play</button>
      </div>
    </div>

    <div id="lyrics"></div>

    <div id="controls">
      <label>ğŸ› Volume <input type="range" id="volume" min="0" max="1" step="0.01" /></label>
      <canvas id="mic-visualizer" width="300" height="100"></canvas>
    </div>

    <audio id="karaoke-audio" controls hidden></audio>
  </div>

  <script>
    const songs = {
      '0001': {
        title: "Pour It Up",
        audio: "pouritup.mp3",
        lyrics: [
          "[Intro] Pour it up, pour it up...",
          "That's how we ball out...",
          "[Verse] Strip clubs and dollar bills..."
        ]
      }
    };

    const codeInput = document.getElementById("songcode");
    const numpad = document.getElementById("numpad");
    const audio = document.getElementById("karaoke-audio");
    const lyricsDiv = document.getElementById("lyrics");
    const volumeSlider = document.getElementById("volume");
    const micCanvas = document.getElementById("mic-visualizer");
    const micCtx = micCanvas.getContext("2d");

    let lyricsInterval;

    numpad.addEventListener("click", (e) => {
      const val = e.target.innerText;
      if (!isNaN(val)) codeInput.value += val;
      if (val === "C") codeInput.value = "";
      if (val === "Play") playKaraoke(codeInput.value);
    });

    function playKaraoke(code) {
      if (!songs[code]) {
        alert("Invalid song code");
        return;
      }
      const song = songs[code];
      audio.src = song.audio;
      audio.play();

      lyricsDiv.innerHTML = "";
      let index = 0;
      clearInterval(lyricsInterval);
      lyricsInterval = setInterval(() => {
        if (index >= song.lyrics.length) return;
        lyricsDiv.innerHTML = song.lyrics[index];
        index++;
      }, 3000);
    }

    volumeSlider.addEventListener("input", () => {
      audio.volume = volumeSlider.value;
    });

    // Mic input visualizer
    navigator.mediaDevices.getUserMedia({ audio: true }).then((stream) => {
      const audioCtx = new AudioContext();
      const source = audioCtx.createMediaStreamSource(stream);
      const analyser = audioCtx.createAnalyser();
      source.connect(analyser);
      const data = new Uint8Array(analyser.frequencyBinCount);

      function draw() {
        requestAnimationFrame(draw);
        analyser.getByteFrequencyData(data);
        micCtx.clearRect(0, 0, micCanvas.width, micCanvas.height);
        data.slice(0, 50).forEach((v, i) => {
          micCtx.fillStyle = "orange";
          micCtx.fillRect(i * 6, micCanvas.height - v / 2, 5, v / 2);
        });
      }
      draw();
    });
  </script>
</body>
</html>
